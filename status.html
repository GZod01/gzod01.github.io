<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://unpkg.com;">
  
  <title>Status Map</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  
  <style type="text/css">
    body { margin: 0; padding: 0; font-family: sans-serif; background: #f0f2f5; }
    #mon-reseau { width: 100vw; height: 100vh; background: #ffffff; }
    .legend { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); pointer-events: none;}
  </style>
</head>
<body>

<div class="legend">
  <strong>Status Serveur</strong><br>
  ðŸŸ¢ Online<br>
  ðŸ”´ Offline<br>
  ðŸŸ¡ Warning
</div>

<div id="mon-reseau"></div>

<script type="text/javascript">
  // --- CONFIGURATION ---
  
  // 1. DÃ©finition des noeuds
  var nodesArray = [
    // Le Serveur Physique (Racine)
    {id: 1, label: 'Mon Serveur\n(Physique)', color: '#4caf50', shape: 'dot', size: 40, font: {color: 'black'}}, 

    // Les VMs (CachÃ©es au dÃ©but)
    {id: 2, label: 'VM - Web\n(Debian)', color: '#4caf50', shape: 'dot', size: 25, hidden: true, group: 'vm'},
    {id: 3, label: 'VM - Data\n(Ubuntu)', color: '#ff9800', shape: 'dot', size: 25, hidden: true, group: 'vm'}, // Orange = Warning

    // Les Services sur VM Web (CachÃ©s)
    {id: 4, label: 'Nginx', color: '#4caf50', shape: 'dot', size: 15, hidden: true, group: 'service'},
    {id: 5, label: 'PHP-FPM', color: '#4caf50', shape: 'dot', size: 15, hidden: true, group: 'service'},

    // Les Services sur VM Data (CachÃ©s)
    {id: 6, label: 'MySQL', color: '#f44336', shape: 'dot', size: 15, hidden: true, group: 'service'}, // Rouge = Down
    {id: 7, label: 'Redis', color: '#4caf50', shape: 'dot', size: 15, hidden: true, group: 'service'}
  ];

  // 2. DÃ©finition des liens (Qui est connectÃ© Ã  qui)
  var edgesArray = [
    // Serveur -> VMs
    {from: 1, to: 2, hidden: true, length: 150},
    {from: 1, to: 3, hidden: true, length: 150},

    // VM Web -> Services
    {from: 2, to: 4, hidden: true, length: 80},
    {from: 2, to: 5, hidden: true, length: 80},

    // VM Data -> Services
    {from: 3, to: 6, hidden: true, length: 80},
    {from: 3, to: 7, hidden: true, length: 80}
  ];

  // --- INITIALISATION VIS.JS ---

  var nodes = new vis.DataSet(nodesArray);
  var edges = new vis.DataSet(edgesArray);
  var container = document.getElementById('mon-reseau');
  
  var data = { nodes: nodes, edges: edges };
  
  var options = {
      nodes: { borderWidth: 2, shadow: true },
      edges: { width: 2, smooth: { type: 'continuous' } },
      interaction: { hover: true },
      physics: { 
          stabilization: false,
          barnesHut: { gravitationalConstant: -2000, springConstant: 0.04 }
      } 
  };
  
  var network = new vis.Network(container, data, options);

  // --- LOGIQUE D'INTERACTION ---

  // Fonction pour afficher les enfants d'un noeud
  function showChildren(parentId) {
      // Trouver tous les liens qui partent de ce parent
      var connectedEdges = edgesArray.filter(e => e.from === parentId);
      
      connectedEdges.forEach(edge => {
          // Rendre le lien visible
          edges.update({id: edge.id, from: edge.from, to: edge.to, hidden: false}); // Note: vis.js gÃ©nÃ¨re des ID auto si on n'en met pas, mais ici on update par matching
          
          // Rendre le noeud enfant visible
          nodes.update({id: edge.to, hidden: false});
      });
      
      // Trouver les arÃªtes existantes dans le DataSet pour les mettre Ã  jour (car edgesArray est juste ma source de vÃ©ritÃ©)
      // MÃ©thode simplifiÃ©e : on parcourt tout edgesArray pour trouver les enfants directs
      var childrenIds = edgesArray.filter(e => e.from === parentId).map(e => e.to);
      
      childrenIds.forEach(childId => {
           nodes.update({id: childId, hidden: false});
           // On cherche l'ID du lien entre parent et enfant pour l'afficher
           var edgesToUpdate = edges.get({
               filter: function (item) {
                   return item.from === parentId && item.to === childId;
               }
           });
           edgesToUpdate.forEach(e => edges.update({id: e.id, hidden: false}));
      });
  }

  // Ã‰vÃ©nement clic
  network.on("click", function (params) {
      if (params.nodes.length > 0) {
          var nodeId = params.nodes[0];
          showChildren(nodeId);
      }
  });

</script>
</body>
</html>
